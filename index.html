<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
   <title>Cars CRUD</title>
 </head>
 <body>

     <div class="container">

      <input type="submit" class="button green" onclick="showModal('modal-add')" value="Add a car">

       <p id="counter"></p>

       <table class="table">
         <tr>
           <th>Name</th>
           <th>Model</th>
           <th>Year</th>
         </tr>
         <tbody id="cars">
         </tbody>
       </table>
   </div>

   <div id="pagesRow"></div>

   <div class="modal-content" id="modal-add">
     <div class="modal-banner">
        <div class="modal-header">
          <a class="close" onclick="hideModal('modal-add')" aria-label="Close">&#10006;</a>
          <h2 class="modal-caption">Add a car</h2>
        </div>
        <div class="modal-body">
           <form action="javascript:void(0);" method="POST" onsubmit="postCar()">
              <input type="text" id="add-name" placeholder="New car name">
              <input type="text" id="add-model" placeholder="New car model">
              <input type="text" id="add-year" placeholder="New car year">
              <div class="modal-footer">
                <input class="button green" type="submit" value="Add">
              </div>
          </form>
        </div>
      </div>
   </div>

   <div class="modal-content" id="modal-edit">
      <div class="modal-banner">
         <div class="modal-header">
           <a class="close" onclick="hideModal('modal-edit')" aria-label="Close">&#10006;</a>
           <h2 class="modal-caption">Edit this car</h2>
         </div>
         <div class="modal-body">
            <form action="javascript:void(0);" method="POST" onsubmit="putCar()">
              <input type="text" id="edit-name">
              <input type="text" id="edit-model">
              <input type="text" id="edit-year">
              <div class="modal-footer">
                <input class="button" type="submit" value="Save">
              </div>
           </form>
         </div>
       </div>
    </div>

    <div class="modal-content" id="modal-delete">
        <div class="modal-banner">
           <div class="modal-header">
             <a class="close" onclick="hideModal('modal-delete')" aria-label="Close">&#10006;</a>
             <h2 class="modal-caption">Delete this car?</h2>
           </div>
           <div class="modal-body">
                <p id="carToDelete"></p>
                <div class="modal-footer">
                  <input class="button red" type="submit" value="No" onclick="hideModal('modal-delete')">
                  <input class="button green" type="submit" value="Yes" id="btn-yes">
            </div>
           </div>
         </div>
      </div>

      <div class="modal-content" id="modal-alert-enter">
        <div class="modal-banner">
           <div class="modal-header">
             <a class="close" onclick="hideModal('modal-alert-enter')" aria-label="Close">&#10006;</a>
             <h2 class="modal-caption">Error!</h2>
           </div>
           <div class="modal-body">
              <p>Please enter car name, model and year</p>
           </div>
           <div class="modal-footer">
                <input class="button" type="submit" value="OK" onclick="hideModal('modal-alert-enter')">
           </div>
         </div>
      </div>

      <div class="modal-content" id="modal-alert-wrongYear">
        <div class="modal-banner">
           <div class="modal-header">
             <a class="close" onclick="hideModal('modal-alert-wrongYear')" aria-label="Close">&#10006;</a>
             <h2 class="modal-caption">Error!</h2>
           </div>
           <div class="modal-body">
              <p>Car Year should be from 1850 till now</p>
            </div>
            <div class="modal-footer">
                 <input class="button" type="submit" value="OK" onclick="hideModal('modal-alert-wrongYear')">
            </div>
          </div>
       </div>

      <div class="modal-content" id="modal-alert-NaN">
        <div class="modal-banner">
           <div class="modal-header">
             <a class="close" onclick="hideModal('modal-alert-NaN')" aria-label="Close">&#10006;</a>
             <h2 class="modal-caption">Error!</h2>
           </div>
           <div class="modal-body">
              <p>Car year should be a number!</p>
            </div>
            <div class="modal-footer">
                 <input class="button" type="submit" value="OK" onclick="hideModal('modal-alert-NaN')">
            </div>
          </div>
       </div>

      <div class="modal-content" id="modal-alert-long">
        <div class="modal-banner">
           <div class="modal-header">
             <a class="close" onclick="hideModal('modal-alert-long')" aria-label="Close">&#10006;</a>
             <h2 class="modal-caption">Error!</h2>
           </div>
           <div class="modal-body">
              <p>It's too long for a car name</p>
            </div>
            <div class="modal-footer">
                 <input class="button" type="submit" value="OK" onclick="hideModal('modal-alert-long')">
            </div>
          </div>
       </div>

      
   
   <footer class="footer">
     <p>2019. made by Evgenii Abramson</p>
   </footer>

<script>

getCars(0);

function showModal (element) {
  document.getElementById(element).style.display = "block";
}

function hideModal (element) {
  document.getElementById(element).style.display = 'none';
}


function validate( a, b, c, d ) {
    let thisYear = new Date().getFullYear();
    if (a == 0 || b == 0 || c == 0) {
      showModal ('modal-alert-enter');
    } else if (d < 1850) {
      showModal ('modal-alert-wrongYear');
    } else if (d > thisYear) {
      showModal ('modal-alert-wrongYear');
    } else if (isFinite(d) == false) {
      showModal ('modal-alert-NaN');
    } else if (a > 35 || b > 35) {
      showModal ('modal-alert-long');
    } else { 
      return true;
    }
  }

function Car(name, model, year) {
  this.name = name;
  this.model = model;
  this.year = year;
}


var app = new function() {

  this.el = document.getElementById('cars');

  this.cars = [];

  this.count = function(data) {
    var el   = document.getElementById('counter');
    var name = 'car';

    if (data) {
      if (data > 1) {
        name = 'cars';
      }
      el.innerHTML = data + ' ' + name + ' on this page, ' + app.totalCars + ' cars total' ;
    } else {
      el.innerHTML = 'No cars';
    }
  };

  var selectedCar;
  var pageable;
  var totalPages;
  var pageNumber;
  var totalCars;
  
  this.fetchAll = function() {
    var data = '';

    if (this.cars.length > 0) {
      for (i = 0; i < this.cars.length; i++) {
        data += '<tr>';
        data += '<td>' + this.cars[i].name + '</td>';
        data += '<td>' + this.cars[i].model + '</td>';
        data += '<td>' + this.cars[i].year + '</td>';
        data += '<td><button class="button short" onclick="editCar('+i+')">&#9998;</button></td>';
        data += '<td><button class="button red short" onclick="delCar('+i+')">&#10006;</button></td>';
        data += '</tr>';
      }
    }


    this.count(this.cars.length);
    return this.el.innerHTML = data;
  };



}

function getCars (pageNumber) {
  const apiUrl = 'https://api.badsoft.tk/bullshit';
  axios.get(apiUrl, { params: { size: 20, page: pageNumber } })
    .then(function (response) {
     app.cars = response.data.content;
     app.pageNumber = response.data.pageable.pageNumber;
     app.totalPages = response.data.totalPages;
     app.totalCars = response.data.totalElements;
     app.fetchAll();
     pagination();
    })
     .catch(function (error) {
       console.log(error);
     })
     .then(function () {
     });

}

function pagination () {
  var el = document.getElementById('pagesRow')
  var data = '';
  if (app.totalPages > 0) {
    for ( i = 0; i < app.totalPages; i++ ) {
      data += '<input type="submit" class="button short" onclick="getCars('+i+')" value="'+(i+1)+'">';
    }
    return el.innerHTML = data;
  }
}

  
function postCar() {
  const apiUrl = 'https://api.badsoft.tk/bullshit';
  var carName = document.getElementById('add-name');
  var carModel = document.getElementById('add-model');
  var carYear = document.getElementById('add-year');

  var car = new Car(carName.value, carModel.value, +carYear.value);

  if ( validate(car.name.length, car.model.length, car.year.length, car.year) ) {
    axios.post(apiUrl, car)
     .then(function (response) {
      getCars(0);
      hideModal('modal-add');
      })
    .catch(function (error) {
      console.log(error);
    })
      // Reset input value
    carName.value = '';
    carModel.value = '';
    carYear.value = '';
    // Dislay the new list
  }
}


function editCar (item) {
  var editName = document.getElementById('edit-name');
  var editModel = document.getElementById('edit-model');
  var editYear = document.getElementById('edit-year');
  // Display value in the field
  editName.value = app.cars[item].name;
  editModel.value = app.cars[item].model;
  editYear.value = app.cars[item].year;
  app.selectedCar = app.cars[item];
  // Display fields
  showModal('modal-edit');
}
 
  
function putCar () {
      // Get value
      var editName = document.getElementById('edit-name');
      var editModel = document.getElementById('edit-model');
      var editYear = document.getElementById('edit-year');
      var carId = app.selectedCar.id;
      var car = new Car(editName.value, editModel.value, editYear.value);
      const apiUrl = 'https://api.badsoft.tk/bullshit/';
 
      if ( validate(car.name.length, car.model.length, car.year.length, car.year) ) {
        // Edit value
        axios.put(apiUrl + carId, car)
          .then(function (response) {
            getCars(0);
           // Hide fields
           hideModal('modal-edit');
           })
          .catch(function (error) {
            console.log(error);
           })
       
       }
}


function delCar (item) {

  confirmDelete(app.cars[item]);

  var btn = document.getElementById('btn-yes');

  btn.onclick = function () {
    const apiUrl = 'https://api.badsoft.tk/bullshit/';
    app.selectedCar = app.cars[item];
    carId = app.selectedCar.id;
    axios.delete(apiUrl + carId)
      .then(function (response) {
        hideModal('modal-delete');
        getCars(0);
        })
      .catch(function (error) {
       console.log(error);
      })
  }
}

function confirmDelete (car) {

  showModal ('modal-delete');

  var el = document.getElementById('carToDelete');
  // Display a car to delete
  if (car.name.length < 36 || car.model.length < 36 ) {
    var data =  car.name + ' ' + car.model + ' ' + car.year;
  } else {
    var data = '(too long to show this shit)';
  }
    return el.innerHTML = data;
}



 








</script>


</body>
</html>